# 🚀 Worker 智能中控 (V7.5 Pro)

一个强大的 Cloudflare Worker 多项目部署与管理面板。支持多账号管理、流量监控、自动更新、版本回溯与锁定、以及智能熔断保护。

> **当前版本**: V7.5 Pro
> **核心特性**: 历史版本收藏 · 动态历史深度 · 熔断版本锁定 · 全代码展开

---

## ✨ 核心功能

### 1. 🛠️ 多项目/多账号管理

* **集中控制**: 在一个面板管理多个 Cloudflare 账号下的 Worker。
* **支持项目**:
* 🔴 **CMliu** (EdgeTunnel)
* 🔵 **Joey** (少年你相信光吗 - 自动修复版)
* 🟢 **ECH** (WebSocket Proxy - 稳定版)


* **变量管理**: 在线增删改 Worker 环境变量 (Secret/Text)，支持从现有项目一键同步配置。

### 2. 📜 版本控制系统 (V7.5 新增)

* **GitHub 历史回溯**: 直接从 GitHub API 拉取最近的 Commit 记录。
* **版本锁定 (Version Locking)**: 选择特定历史版本进行部署，项目将自动进入 **"Locked" (锁定)** 模式，停止自动追新，防止上游更新导致不可用。
* **⭐ 收藏夹**: 将表现优秀的版本加入收藏，永久置顶，不会被新的提交记录冲掉。
* **动态深度**: 前端可自定义获取历史记录的数量（如最近 10 条、50 条）。

### 3. 🛡️ 智能熔断与自动更新

* **流量熔断**: 设定流量阈值 (例如 90%)，当账号流量即将耗尽时，自动轮换 UUID 并重新部署。
* **智能策略**: 熔断部署时，**严格遵守当前的版本锁定状态**。如果你锁定了旧版本，熔断时只会修改 UUID，而不会意外升级到最新代码。


* **自动更新**: 定时检查上游代码变更（仅在非锁定模式下生效）。

### 4. 📊 监控与统计

* **实时流量**: 查看每个账号当天的请求数、总额度及使用百分比。
* **可视化进度条**: 颜色区分流量健康度 (🟢 正常 / 🟠 预警 / 🔴 危险)。

---

## ⚙️ 部署指南

### 第一步：准备工作

1. 拥有一个 [Cloudflare](https://dash.cloudflare.com/) 账号。
2. 准备好 GitHub Token (可选，用于提高 API 请求限额，防止获取历史记录失败)。

### 第二步：创建 KV 命名空间

1. 进入 Cloudflare Dashboard -> **Workers & Pages** -> **KV**.
2. 点击 **Create a Namespace**。
3. 命名为 `CONFIG_KV` (或者其他你喜欢的名字)，点击 Add。

### 第三步：创建 Worker

1. 创建一个新的 Worker。
2. 点击 **Settings** -> **Variables**.
3. **KV Namespace Bindings**:
* Variable name: `CONFIG_KV` (必须完全一致)
* KV Namespace: 选择上一步创建的 KV。


4. **Environment Variables** (可选):
* `ACCESS_CODE`: 设置访问密码（建议设置，防止他人访问）。
* `GITHUB_TOKEN`: 你的 GitHub Personal Access Token (用于获取更多历史记录)。



### 第四步：部署代码

1. 点击 **Edit code**。
2. 将 `worker.js` (V7.5) 的所有代码复制并覆盖 `worker.js`。
3. 点击 **Deploy**。

---

## 📖 使用手册

### 1. 添加账号

1. 在面板首页点击 **"➕ 添加账号"**。
2. 填写 **备注**、**Account ID** 和 **API Token** (需要有编辑 Workers 的权限)。
3. 在对应的项目栏 (CMliu/Joey/ECH) 填写该账号下已创建的 Worker 名称（多个名称用逗号分隔）。
4. 点击保存。

### 2. 部署与版本管理

* **部署最新版**: 点击项目卡片中的 **"🚀 部署"**，默认拉取最新代码并开启自动更新。
* **选择历史版本**:
1. 点击 **"📜 历史/收藏"** 按钮。
2. 在列表中选择一个 Commit，点击即可回滚/锁定到该版本。
3. 点击 **⭐** 号可收藏版本。


* **调整历史数量**: 在顶部导航栏的 **"历史:"** 输入框中调整数字（如 20），点击保存，再次打开历史弹窗即可加载更多记录。

### 3. 设置熔断与自动更新

在顶部导航栏设置：

* **自动检测**: 开启/关闭 Cron 定时任务。
* **间隔**: 检查频率（分钟）。
* **熔断**: 设置百分比（如 90）。当任一账号流量超过 90% 时，触发熔断逻辑（换 UUID + 重部署）。

### 4. 访问地址

访问 `https://你的worker域名/?code=你的密码` (如果设置了 ACCESS_CODE)。

---

## 🧩 常见问题

**Q: 为什么获取历史版本显示 "Failed"?**
A: GitHub API 对未授权请求有限制。请在 Worker 环境变量中添加 `GITHUB_TOKEN`。

**Q: 锁定版本后，自动更新还会生效吗？**
A: 不会。一旦选择特定版本部署，项目模式变为 `fixed` (锁定)。自动更新检查会跳过该项目，但**熔断保护依然生效**（熔断时会使用你锁定的那个版本代码）。要恢复自动更新，请在历史弹窗中选择顶部的 **"⚡ Always Latest"**。

**Q: ECH 项目怎么配置 IP？**
A: 在 ECH 卡片中，使用下拉菜单选择 ProxyIP，或者手动添加 `PROXYIP` 变量。部署时，该 IP 会自动写入代码常量中。

---

**Disclaimer**: 本项目仅供技术研究与交流学习使用，请勿用于非法用途。
